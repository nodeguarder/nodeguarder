# Distribution Guide

This guide covers how to package and distribute NodeGuarder to customers.

## Table of Contents
- [Prerequisites](#prerequisites)
- [Build Process](#build-process)
- [Customer Onboarding](#customer-onboarding)

---

## Prerequisites
- Access to the `deploy/` directory.
- `private.key` (generated by `license_tool`).
- Docker registry access.
- Go installed (for building agent binaries via script).

---

## Build Process

### 1. Generate Public/Private Keys (One Time)
If you haven't already:
```bash
cd deploy/license_tool
go run main.go generate-keys
# Keeps private.key SAFE.
# Copy public.key to dashboard/backend/ before building the image.
```

### 2. Build the Customer Image
The **Customer Image** is self-contained. It includes the backend, frontend, and pre-compiled agent binaries for Linux AMD64/ARM64.

1.  Ensure `public.key` is in `dashboard/backend/`.
2.  Build the image (specifying the version):
    ```bash
    # Example: Build version 1.2.0
    docker build -f deploy/Dockerfile \
                 --build-arg VERSION=1.2.0 \
                 -t nodeguarder:1.2.0 .
    ```
3.  Push this image to your registry.
    ```bash
    docker push registry.example.com/nodeguarder:1.2.0
    ```

### 3. Sign Artifacts (Recommended)
We recommend using **Cosign** (part of Sigstore) to sign your Docker images and binaries to ensure supply chain security.
```bash
# Sign Docker Image
cosign sign registry.example.com/nodeguarder:1.2.0

# Sign Binaries (if distributing separately)
cosign sign-blob --output-signature agent.sig agent-binaries/nodeguarder-agent-linux-amd64
```

---

## Customer Onboarding

### Deliverable Package
For GitHub Releases or Customer delivery, provide the zip file generated by `package_release.sh`:

**`nodeguarder-deploy-vX.X.X.zip` contains:**
- `docker-compose.yml`
- `nginx.conf`
- `license.yaml.example` (Reference / template)
- `certs/` (Pre-generated localhost certificate)

Customers simply unzip and run:
`docker compose up -d`

**Note**: You do **NOT** need to send an `agent-binaries` folder. The Docker image contains them.

### Basic / Free Users (Default)
1.  **Deliver**: Send the package above.
2.  **License**: **No action needed.**
3.  **Deploy**: Customer runs `docker compose up -d`.
4.  **Agents**: Customer downloads agents directly from their new Dashboard.

### Standard / Pro / Enterprise Customers
1.  **Generate License**:
    ```bash
    cd deploy/license_tool
    go run main.go create-license --tier standard --company "ACME Corp" --private-key private.key
    ```
2.  **Deliver**:
    - Send the standard package.
    - Send the generated `license.yaml`.
3.  **Instructions**:
    - Ask the customer to place `license.yaml` in the deployment directory.
    - Restarting the container will load the new license.

---

## Internal Security Checklist (For Maintainers)
This checklist is for the **Release Manager** to ensure a secure release. Customers do not perform these steps.
- [ ] **Keep `private.key` SECURE.** Never distribute it.
- [ ] Ensure `public.key` is embedded in the image.
- [ ] Verify that modifying `license.yaml` breaks the signature.
