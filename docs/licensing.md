# Licensing System

NodeGuarder uses a simple licensing system based on digital signatures. This allows for a **Generic Customer Image** that can be distributed to all customers without modification.

## Table of Contents
- [License Tiers](#license-tiers)
- [How It Works](#how-it-works)
- [Generating Licenses](#generating-licenses)
- [Managing Licenses](#managing-licenses)

---

## License Tiers

| Tier | Capacity | Price | Support | Note |
|------|----------|-------|---------|------|
| **Community** | 5 Servers | Free | Community | **Default.** Included in the customer image. |
| **Pro** | 30 Servers | $99/year | Email | For small businesses. |
| **Pro+** | 100 Servers | $299/year | Priority | For growing infrastructure. |
| **Enterprise** | Custom | Custom | Dedicated | For large organizations (100+ servers). |

---

## How It Works

The system uses **Ed25519 digital signatures** to verify license authenticity.

1.  **Vendor (You)** holds the `private.key`. You use this to sign license files.
2.  **Customer Image** contains the `public.key`. This key is embedded in the generic image.
3.  **Validation**: When the dashboard starts or checks the license, it verifies the signature against the public key. If the signature is invalid or the file is missing, it falls back to the **Free Tier (5 Servers)**.

This means you can distribute the **same Docker image** to everyone. Customers start with the Free tier and can upgrade by simply replacing the `license.yaml` file.

---

## Generating Licenses

Use the `deploy/license_tool` to generate signed licenses.

### Prerequisites
- You must have the `private.key` generated by `go run main.go generate-keys`.

### Commands

#### Create a Standard License
```bash
go run main.go create-license \
  --tier standard \
  --company "Customer Name" \
  --private-key private.key \
  --output license-customer.yaml
```

#### Create a Pro License
```bash
go run main.go create-license \
  --tier pro \
  --company "Customer Name" \
  --private-key private.key \
  --output license-customer.yaml
```

---



---

## Managing Licenses

### Upgrading a Customer
1.  Generate the new license file (e.g., `license-standard.yaml`).
2.  Send the file to the customer.
3.  **Customer Instruction**:
    - Replace the existing `license.yaml` in their deployment directory with the new file.
    - Checks `Settings > License` to verify the upgrade.

### Troubleshooting
- **"Invalid Signature"**: The license file may have been tampered with or corrupted. Re-issue the license.
- **"Free Tier Active"**: If the `license.yaml` is missing or invalid, the system defaults to the Free tier.
